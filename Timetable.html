<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Custom Timetable Manager</title>
<style>
/* CSS Styles */
:root {
    --primary-color: #007bff;
    --secondary-color: #28a745;
    --primary-gradient: linear-gradient(90deg, #007bff, #0056b3);
    --secondary-gradient: linear-gradient(90deg, #28a745, #1e7e34);
    --bg-color: #f4f7f6;
    --text-color: #212529;
    --card-bg: #ffffff;
    --border-color: #e9ecef;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

body.dark {
    --bg-color: #1a1a2e;
    --text-color: #f0f0f0;
    --card-bg: #2c2c54;
    --border-color: #4a4a8a;
    --shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

body { margin:0; padding:0; font-family:Arial,sans-serif; background:var(--bg-color); color:var(--text-color); transition: background 0.3s,color 0.3s; }

.container { max-width:1000px; margin:40px auto; background:var(--card-bg); padding:30px; border-radius:15px; box-shadow:var(--shadow); transition: background 0.3s,color 0.3s; }

h2{text-align:center;color:var(--primary-color);margin-bottom:25px;}
h3,h4{margin:15px 0 10px;color:var(--text-color);}

button{padding:10px 15px;border:none;border-radius:8px;cursor:pointer;background:var(--primary-gradient);color:#fff;font-size:15px;font-weight:600;transition: transform 0.2s, opacity 0.2s, box-shadow 0.2s; box-shadow:0 3px 6px rgba(0,0,0,0.15); margin-bottom:5px;}
button:hover{opacity:0.95; transform:translateY(-1px); box-shadow:0 5px 10px rgba(0,0,0,0.2);}
#delete-account-btn,#confirm-delete-entry{background:linear-gradient(90deg, #dc3545, #c82333) !important;}
#cancel-delete-entry{background:linear-gradient(90deg, #6c757d, #5a6268) !important;}

input,select{padding:12px; font-size:16px; border-radius:8px; border:1px solid var(--border-color); width:100%; box-sizing:border-box; margin-bottom:15px; background:var(--bg-color); color:var(--text-color); transition:border-color 0.3s, background 0.3s;}
input:focus,select:focus{border-color:var(--primary-color); outline:none;}

.section{margin-bottom:30px; padding:20px; border-radius:10px; background:var(--card-bg); box-shadow:0 2px 4px rgba(0,0,0,0.05); border:1px solid var(--border-color);}
.page{display:none;}

#timetable-section{display:block; gap:20px;}

table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:8px; margin-top:15px; box-shadow:0 1px 3px rgba(0,0,0,0.1);}
th,td{padding:12px 15px; border-bottom:1px solid var(--border-color); text-align:left;}
th{background:var(--secondary-gradient); color:#fff; font-weight:700; text-transform:uppercase; letter-spacing:0.05em;}
tr:last-child td{border-bottom:none;}
tr:nth-child(even){background:var(--bg-color);}

#notification{position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--secondary-gradient); color:#fff; padding:12px 25px; border-radius:25px; box-shadow:0 4px 10px rgba(0,0,0,0.2); display:none; z-index:1000; font-weight:500; max-width:90%; text-align:center;}

#darkmode-toggle{display:block; width:200px; margin:0 auto 20px; background:linear-gradient(90deg, #5a6268, #343a40);}

.auth-panel{max-width:400px; margin:20px auto; gap:15px; display:flex; flex-direction:column;}
.auth-panel hr{border-color:var(--border-color);}

#account-list-container{display:flex; flex-direction:column; gap:10px; max-height:150px; overflow-y:auto; padding:5px; border:1px solid var(--border-color); border-radius:8px; margin-bottom:15px;}
.account-login-btn{width:100%; text-align:left; background:linear-gradient(90deg, #2a94ff, #007bff);}

.account-settings-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:20px; margin-top:20px;}
.setting-card{padding:20px; border:1px solid var(--border-color); border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.05); background:var(--card-bg);}
.setting-card h4{margin-top:0; border-bottom:1px solid var(--border-color); padding-bottom:10px; margin-bottom:15px;}

#navbar{display:flex; gap:10px; margin-bottom:20px; padding:10px 0; border-bottom:2px solid var(--border-color);}
.nav-btn{flex-grow:1; background:var(--secondary-gradient);}

/* Custom edit inline buttons */
.edit-btn {background:linear-gradient(90deg, #ffc107, #e0a800); color:#212529;}
.save-btn {background:linear-gradient(90deg, #28a745, #1e7e34);}
.cancel-btn {background:linear-gradient(90deg, #6c757d, #5a6268);}
.edit-btn,.save-btn,.cancel-btn{padding:5px 10px;border-radius:5px;margin-right:5px;font-size:14px;font-weight:600;}

@media(max-width:768px){
    .container{margin:10px; padding:15px;}
    .account-settings-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>
<div class="container">
    <h2>Custom Timetable Manager</h2>
    <button id="darkmode-toggle">Toggle Dark Mode</button>
    <div id="navbar" style="display:none;">
        <button id="nav-timetable" class="nav-btn">üìÖ My Timetable</button>
        <button id="nav-account" class="nav-btn">‚öôÔ∏è Account Settings</button>
        <button id="logout-btn" style="width:auto; background: linear-gradient(90deg, #dc3545, #c82333);">Logout</button>
    </div>

    <div id="auth-section" class="page section auth-panel">
        <h3>Create Account</h3>
        <input type="text" id="reg-username" placeholder="Username" required>
        <input type="password" id="reg-password" placeholder="Password" required>
        <button id="create-account-btn">Create Account</button>
        <hr>
        <h3>Login</h3>
        <div id="account-list-container">
            <p style="text-align: center; color: var(--text-color);">No accounts found.</p>
        </div>
        <input type="password" id="login-password" placeholder="Password" required>
        <button id="login-btn">Login to Selected Account</button>
    </div>

    <div id="account-section" class="page section">
        <h3>Account Settings for <span id="user-display"></span></h3>
        <div class="account-settings-grid">
            <div class="setting-card">
                <h4>üë§ Rename Account</h4>
                <input type="text" id="new-username" placeholder="New Username">
                <button id="rename-btn">Rename Account</button>
            </div>
            <div class="setting-card">
                <h4>üîë Change Password</h4>
                <input type="password" id="current-password" placeholder="Current Password">
                <input type="password" id="new-password" placeholder="New Password">
                <button id="change-password-btn">Change Password</button>
            </div>
            <div class="setting-card">
                <h4>üóëÔ∏è Delete Account</h4>
                <input type="password" id="del-password" placeholder="Confirm Password to Delete">
                <button id="delete-account-btn">Delete Account</button>
            </div>
        </div>
    </div>

    <div id="timetable-section" class="page section">
        <h3>Your Timetable</h3>
        <input type="text" id="time-entry" placeholder="Time (e.g., 9AM - 10AM)">
        <input type="text" id="activity-entry" placeholder="Activity / Subject">
        <button id="add-entry-btn">Add Entry</button>
        <button id="export-csv">Export CSV</button>
        <table id="timetable-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Activity</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="notification"></div>

<script>
// Utility functions
const notification=document.getElementById('notification');
const showNotification=(msg,type='info',confirmationData=null)=>{
    let bgColor;
    switch(type){
        case'error':bgColor='linear-gradient(90deg, #dc3545, #c82333)';break;
        case'success':bgColor='linear-gradient(90deg, #28a745, #1e7e34)';break;
        case'confirm':bgColor='linear-gradient(90deg, #ffc107, #e0a800)';break;
        default:bgColor='var(--secondary-gradient)';
    }
    notification.style.background=bgColor;
    let content=`<p style="margin:0;font-size:1.1em;">${msg}</p>`;
    if(type==='confirm'&&confirmationData){
        content+=`<div style="margin-top:10px;">
            <button id="confirm-delete-entry" style="margin-right:10px;">Yes, Delete</button>
            <button id="cancel-delete-entry">Cancel</button>
        </div>`;
    }
    notification.innerHTML=content; notification.style.display='block';
    if(type!=='confirm'){setTimeout(()=>{notification.style.display='none';},3000);}
    if(type==='confirm'&&confirmationData){
        document.getElementById('confirm-delete-entry').onclick=()=>{notification.style.display='none'; window.deleteEntryConfirmed(confirmationData.index);};
        document.getElementById('cancel-delete-entry').onclick=()=>{notification.style.display='none'; showNotification("Deletion cancelled.",'info');};
    }
};

const hashPassword=async pw=>btoa(pw).split('').reverse().join('');
const saveUserData=(u,d)=>localStorage.setItem(`user_${u}`,JSON.stringify(d));
const loadUserData=u=>{const d=localStorage.getItem(`user_${u}`);return d?JSON.parse(d):null;};
const getAccountList=()=>Object.keys(localStorage).filter(k=>k.startsWith('user_')).map(k=>k.slice(5));

let currentUser=null; let selectedLoginUser=null;

// Page navigation
const showPage=pageId=>{document.querySelectorAll('.page').forEach(p=>p.style.display='none'); document.getElementById(pageId).style.display='block';};
const navigateTo=pageId=>{if(currentUser){document.getElementById('navbar').style.display='flex'; showPage(pageId);}else{document.getElementById('navbar').style.display='none'; showPage('auth-section');}};

document.getElementById('nav-timetable').addEventListener('click',()=>navigateTo('timetable-section'));
document.getElementById('nav-account').addEventListener('click',()=>navigateTo('account-section'));
document.getElementById('logout-btn').addEventListener('click',()=>{currentUser=null; selectedLoginUser=null; showNotification("Logged out!",'info'); navigateTo('auth-section'); updateAccountListUI();});

// Restore Dark Mode on Page Load
if (localStorage.getItem("darkMode") === "enabled") {
    document.body.classList.add("dark");
}

// Dark mode toggle
document.getElementById('darkmode-toggle').addEventListener('click', () => {
    document.body.classList.toggle('dark');

    // Save user preference
    if (document.body.classList.contains('dark')) {
        localStorage.setItem("darkMode", "enabled");
    } else {
        localStorage.setItem("darkMode", "disabled");
    }
});


// Account list
function updateAccountListUI(){
    const container=document.getElementById('account-list-container'); container.innerHTML='';
    const accounts=getAccountList();
    if(accounts.length===0){container.innerHTML='<p style="text-align:center;color:var(--text-color);">No accounts found.</p>'; return;}
    accounts.forEach(u=>{
        const btn=document.createElement('button'); btn.className='account-login-btn'; btn.textContent=`Login as ${u}`; btn.setAttribute('data-username',u);
        btn.addEventListener('click',function(){
            document.querySelectorAll('.account-login-btn').forEach(b=>{b.style.border='none'; b.style.boxShadow='0 3px 6px rgba(0,0,0,0.15)';});
            selectedLoginUser=u; this.style.border='2px solid yellow'; this.style.boxShadow='0 0 10px var(--primary-color)';
        });
        container.appendChild(btn);
    });
}
updateAccountListUI();

// Create account
document.getElementById('create-account-btn').addEventListener('click',async()=>{
    const u=document.getElementById('reg-username').value.trim(); const p=document.getElementById('reg-password').value;
    if(!u||!p){showNotification("Enter username and password",'error'); return;}
    if(localStorage.getItem(`user_${u}`)){showNotification("Username exists!",'error'); return;}
    saveUserData(u,{password:await hashPassword(p),timetable:[]});
    showNotification("Account created! Login now.",'success');
    document.getElementById('reg-username').value=''; document.getElementById('reg-password').value='';
    updateAccountListUI();
});

// Login
document.getElementById('login-btn').addEventListener('click',async()=>{
    const u=selectedLoginUser; const p=document.getElementById('login-password').value;
    if(!u){showNotification("Please select an account above",'error'); return;}
    const data=loadUserData(u); if(!data){showNotification("User not found!",'error'); return;}
    if(await hashPassword(p)!==data.password){showNotification("Incorrect password!",'error'); return;}
    currentUser=u; document.getElementById('user-display').textContent=currentUser; document.getElementById('login-password').value=''; selectedLoginUser=null;
    renderTimetable(); showNotification(`Welcome, ${currentUser}!`,'success'); navigateTo('timetable-section');
});

// Account settings
document.getElementById('rename-btn').addEventListener('click',()=>{
    const newU=document.getElementById('new-username').value.trim();
    if(!newU){showNotification("Enter new username",'error'); return;}
    if(localStorage.getItem(`user_${newU}`)){showNotification("Username exists!",'error'); return;}
    const d=loadUserData(currentUser); localStorage.removeItem(`user_${currentUser}`); saveUserData(newU,d);
    currentUser=newU; document.getElementById('user-display').textContent=currentUser; document.getElementById('new-username').value='';
    updateAccountListUI(); showNotification("Username changed!",'success');
});

document.getElementById('change-password-btn').addEventListener('click',async()=>{
    const curr=document.getElementById('current-password').value; const np=document.getElementById('new-password').value;
    if(!curr||!np){showNotification("Enter current and new passwords",'error'); return;}
    const d=loadUserData(currentUser); if(await hashPassword(curr)!==d.password){showNotification("Current password incorrect!",'error'); return;}
    d.password=await hashPassword(np); saveUserData(currentUser,d);
    document.getElementById('current-password').value=''; document.getElementById('new-password').value=''; showNotification("Password changed!",'success');
});

document.getElementById('delete-account-btn').addEventListener('click',async()=>{
    const pw=document.getElementById('del-password').value; const d=loadUserData(currentUser);
    if(await hashPassword(pw)!==d.password){showNotification("Password incorrect!",'error'); return;}
    localStorage.removeItem(`user_${currentUser}`); currentUser=null; document.getElementById('del-password').value='';
    updateAccountListUI(); showNotification("Account deleted!",'info'); navigateTo('auth-section');
});

// Timetable rendering
const renderTimetable=()=>{
    const tbody=document.querySelector('#timetable-table tbody'); tbody.innerHTML='';
    const data=loadUserData(currentUser); if(!data) return;
    data.timetable.sort((a,b)=>a.time.localeCompare(b.time));
    data.timetable.forEach((e,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${e.time}</td><td>${e.activity}</td>
        <td>
            <button class="edit-btn" onclick="editEntry(${i})">Edit</button>
            <button onclick="deleteEntry(${i})" style="background:linear-gradient(90deg,#dc3545,#c82333);">Delete</button>
        </td>`;
        tbody.appendChild(tr);
    });
};

// Add entry
document.getElementById('add-entry-btn').addEventListener('click',()=>{
    const t=document.getElementById('time-entry').value.trim(); const a=document.getElementById('activity-entry').value.trim();
    if(!t||!a){showNotification("Enter time and activity",'error'); return;}
    const data=loadUserData(currentUser); data.timetable.push({time:t,activity:a}); saveUserData(currentUser,data); renderTimetable();
    document.getElementById('time-entry').value=''; document.getElementById('activity-entry').value=''; showNotification("Entry added!",'success');
});

// Custom inline edit
window.editEntry=(i)=>{
    const tbody=document.querySelector('#timetable-table tbody'); const tr=tbody.children[i]; const data=loadUserData(currentUser);
    const entry=data.timetable[i];
    tr.innerHTML=`<td><input type="text" value="${entry.time}" style="width:100%;padding:5px;"/></td>
    <td><input type="text" value="${entry.activity}" style="width:100%;padding:5px;"/></td>
    <td><button class="save-btn">Save</button><button class="cancel-btn">Cancel</button></td>`;
    tr.querySelector('.save-btn').addEventListener('click',()=>{
        const newTime=tr.children[0].children[0].value.trim(); const newAct=tr.children[1].children[0].value.trim();
        if(!newTime||!newAct){showNotification("Enter time and activity",'error'); return;}
        data.timetable[i]={time:newTime,activity:newAct}; saveUserData(currentUser,data); renderTimetable(); showNotification("Entry updated!",'success');
    });
    tr.querySelector('.cancel-btn').addEventListener('click',()=>{renderTimetable(); showNotification("Edit cancelled",'info');});
};

// Delete entry
window.deleteEntry=(i)=>{showNotification("Do you really want to delete this timetable entry?",'confirm',{index:i});};
window.deleteEntryConfirmed=(i)=>{const d=loadUserData(currentUser); d.timetable.splice(i,1); saveUserData(currentUser,d); renderTimetable(); showNotification("Entry deleted!",'info');};

// Export CSV
document.getElementById('export-csv').addEventListener('click',()=>{
    const data=loadUserData(currentUser); if(!data || data.timetable.length===0){showNotification("No entries to export!",'error'); return;}
    let csv="Time,Activity\n"; data.timetable.forEach(e=>{csv+=`"${e.time.replace(/"/g,'""')}","${e.activity.replace(/"/g,'""')}"\n`;});
    const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${currentUser}_timetable.csv`; a.click(); showNotification("CSV exported!",'success');
});

// Initialize view
navigateTo('auth-section');
</script>
</body>
</html>
